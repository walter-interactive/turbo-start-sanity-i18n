# Test Failure Report: T026

**Task**: Navigate to "Blogs" list and verify only FR versions appear
**Date**: 2025-11-12
**Status**: ❌ **FAILED**
**Tester**: Automated test using Playwright MCP

---

## Summary

Language filtering is **NOT working for the Blogs list**. The list shows duplicate entries for documents that have multiple language versions (FR and EN), when it should only display the default language (FR) versions.

---

## Evidence

### Duplicate Entries Found:

1. **"Secured Systematic Capacity"** appears **twice**:
   - **First entry**: French (fr) - default language ✓
   - **Second entry**: English (en) - should be filtered out ✗

2. **"Enhanced 24 hour Structure"** appears **twice**:
   - **First entry**: One language version
   - **Second entry**: Another language version

### Screenshots:

1. `blogs-list-with-duplicates.png` - Shows both FR and EN versions in the list
2. `first-secured-systematic-is-french.png` - Confirms first entry is FR (Français)
3. `second-secured-systematic-is-english.png` - Confirms second entry is EN (English)

All screenshots saved to: `.playwright-mcp/` directory

---

## Root Cause Analysis

The Blogs list is using the **`@sanity/orderable-document-list`** plugin for drag-and-drop ordering functionality. This plugin creates a custom document list implementation that doesn't automatically respect the language filtering applied via standard `S.documentList()` methods.

### Comparison with Working Implementation:

**FAQs (Working)** - Uses standard document list with filter:
```typescript
S.documentList()
  .title("FAQs")
  .filter('_type == $type && (!defined(language) || language == $language)')
  .params({ type: 'faq', language: DEFAULT_LOCALE })
```

**Blogs (Not Working)** - Uses orderable document list:
```typescript
// Located around apps/studio/structure.ts:79
// Uses @sanity/orderable-document-list plugin
// Need to investigate how to apply language filter to orderable lists
```

### Related Completed Tasks:

From `tasks.md`:
- ✓ T020: Import DEFAULT_LOCALE from @workspace/i18n-config in apps/studio/structure.ts
- ✓ T021: Update FAQ list to use S.documentList() with language filter
- ✓ T022: Add GROQ filter to FAQ documentList with language parameter

---

## Impact

**Severity**: High
**Priority**: P1 (MVP requirement)

### User Impact:
- Content editors see duplicate blog entries in the Studio
- Confusing UX - same content appears multiple times
- Difficult to identify which entry is which language
- Goes against the primary goal of User Story 1: "Show only default language (FR) versions in Sanity Studio document lists"

### Affected Areas:
- Blogs list only (Pages and FAQs are working correctly per T025, T027)
- Any other document types that use `@sanity/orderable-document-list` may have the same issue

---

## Technical Details

### Test Method:
1. Navigated to Sanity Studio at http://localhost:3333
2. Clicked on Structure tab
3. Clicked on "Blogs" → "Blogs" (orderable list)
4. Inspected list items
5. Opened first "Secured Systematic Capacity" → Clicked Translations → Confirmed FR
6. Returned to list
7. Opened second "Secured Systematic Capacity" → Clicked Translations → Confirmed EN

### Expected Behavior:
- Only FR (default language) versions should appear in the Blogs list
- Each blog post should appear exactly once
- EN versions should be accessible only via the Translations badge when opening a document

### Actual Behavior:
- Both FR and EN versions appear in the Blogs list
- Blog posts with translations appear multiple times (duplicates)
- No visual indication of which entry is which language

---

## Investigation Required

### Files to Check:

1. **`apps/studio/structure.ts`** (around line 79)
   - Locate the Blogs orderable list configuration
   - Investigate how `@sanity/orderable-document-list` is configured

2. **`@sanity/orderable-document-list` documentation**
   - Check if the plugin supports custom GROQ filters
   - Investigate `filter` or `query` options for the orderable list

3. **`apps/studio/components/nested-pages-structure.ts`**
   - Review how Pages list implements filtering successfully
   - Consider if Blogs can use similar approach

### Potential Solutions:

**Option A**: Apply filter to orderable list configuration
```typescript
// Pseudo-code - needs verification
orderableDocumentListDeskItem({
  type: 'blog',
  title: 'Blogs',
  filter: '!defined(language) || language == $language',
  params: { language: DEFAULT_LOCALE }
})
```

**Option B**: Use custom GROQ query
```typescript
// Check if orderable plugin supports custom queries
orderableDocumentListDeskItem({
  type: 'blog',
  title: 'Blogs',
  query: '*[_type == "blog" && (!defined(language) || language == $language)]',
  params: { language: DEFAULT_LOCALE }
})
```

**Option C**: Wrap orderable list with custom filter
- Create a custom list component that filters documents before passing to orderable list
- May require more complex implementation

---

## Next Steps

1. **Immediate**: Investigate `apps/studio/structure.ts` to understand current Blogs list configuration
2. **Research**: Review `@sanity/orderable-document-list` plugin documentation for filtering options
3. **Implement**: Apply language filter to orderable document list
4. **Test**: Re-run T026 to verify fix
5. **Validate**: Ensure drag-and-drop ordering still works after applying filter

---

## References

- **Task Definition**: `specs/003-dedup-studio-records/tasks.md` line 89
- **User Story**: US1 - View De-duplicated Document Lists (Priority: P1)
- **Acceptance Criteria**: Document lists show only FR (default) versions, no duplicates
- **Related Documentation**:
  - `specs/003-dedup-studio-records/plan.md` - Implementation plan
  - `specs/003-dedup-studio-records/research.md` - GROQ filtering patterns
  - `specs/003-dedup-studio-records/quickstart.md` - Testing procedures

---

## Notes

- Pages list (T025) and FAQs list (T027) are working correctly with language filtering
- The issue is specific to document types using the orderable document list plugin
- The Translations badge and language switching functionality work correctly (as verified during testing)
- This is a **regression/incomplete implementation**, not a new feature request

---

**Last Updated**: 2025-11-12
**Assigned To**: Pending investigation
**Blocked Tasks**: None (other user stories can proceed independently)
